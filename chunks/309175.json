{
    "exports": {
        "ChannelRTCParticipantsIndexes": {
            "VIDEO": "VIDEO",
            "STREAM": "STREAM",
            "FILTERED": "FILTERED",
            "SPEAKING": "SPEAKING",
            "ACTIVITY": "ACTIVITY"
        },
        "default": "class N{constructor(e){this.participants={},this.lastSpoke={},this.participantByIndex=new a.default(e=>{let t=[];return e.type===I.ParticipantTypes.USER&&e.speaking&&t.push(\"SPEAKING\"),e.type===I.ParticipantTypes.USER&&e.voiceState?.selfVideo?(t.push(\"VIDEO\"),!e.localVideoDisabled&&t.push(\"FILTERED\")):(0,I.isStreamParticipant)(e)&&(t.push(\"STREAM\"),e.type!==I.ParticipantTypes.HIDDEN_STREAM&&null!=e.streamId&&t.push(\"FILTERED\")),e.type===I.ParticipantTypes.ACTIVITY&&t.push(\"ACTIVITY\"),t},A),this.channelId=e}get version(){return this.participantByIndex.version}size(e){return this.participantByIndex.size(e)}toArray(e){return this.participantByIndex.values(e,!0)}rebuild(){let e=c.default.getChannel(this.channelId);if(null==e||e.type===T.ChannelTypes.GUILD_TEXT)return!1;if(this.call=_.default.getCall(this.channelId),e.isPrivate()&&(null==this.call||this.call.unavailable))return!1;let t=new Set(e.isGuildVocalOrThread()?Object.keys(p.default.getVoiceStatesForChannel(e.id)):e.recipients);return t.add(f.default.getId()),l.default.getAllActiveStreamsForChannel(this.channelId).forEach(e=>{let{ownerId:n}=e;return t.add(n)}),this.participantByIndex.clear(),this.participants={},t.forEach(e=>this.updateParticipant(e)),this.updateEmbeddedActivities(),!0}getParticipant(e){return this.participantByIndex.get(e)??null}updateEmbeddedActivities(){return this.updateParticipant(C)}hasEmbeddedActivity(){let e=this.participants[C];return null!=e&&e.length>0}updateParticipant(e){let t=this.participants[e],n=e===C?this._getParticipantsForEmbeddedActivities():this._getParticipantsForUser(e);return(null!=t||0!==n.length)&&(t?.forEach(e=>{this.participantByIndex.delete(e.id)}),n.forEach(e=>{this.participantByIndex.set(e.id,e)}),this.participants[e]=n,!0)}updateParticipantSpeaking(e){return this.participants[e]?.reduce((t,n)=>{if(n.type===I.ParticipantTypes.USER){let t=o.getIsSpeaking({userId:e,checkIsMuted:!0});return t&&(this.lastSpoke[e]=Date.now()),this.participantByIndex.set(n.id,{...n,speaking:t,lastSpoke:this.lastSpoke[e],soundsharing:m.default.isSoundSharing(e)}),!0}return t},!1)??!1}updateParticipantQuality(e,t,n){return this.participants[e]?.reduce((e,s)=>s.type===I.ParticipantTypes.STREAM?(this.participantByIndex.set(s.id,{...s,maxResolution:t,maxFrameRate:n}),!0):e,!1)??!1}_getEmbeddedActivities(){let e=u.default.getEmbeddedActivitiesForChannel(this.channelId),t=u.default.getSelfEmbeddedActivityForChannel(this.channelId);return null==t?e:(0,r.uniqBy)([...e,t],e=>e.applicationId)}_getParticipantsForEmbeddedActivities(){return this._getEmbeddedActivities().map((e,t)=>({type:I.ParticipantTypes.ACTIVITY,id:e.applicationId,activityType:T.ActivityTypes.PLAYING,activityUrl:e.url,participants:new Set(e.userIds),guildId:c.default.getChannel(this.channelId)?.getGuildId()??null,sortKey:t.toString()}))}_getParticipantsForUser(e){let t,n;let s=[],i=h.default.getUser(e);if(null==i)return s;let r=p.default.getVoiceStateForChannel(this.channelId,e),a=p.default.getVoicePlatformForChannel(this.channelId,e),u=c.default.getChannel(this.channelId),_=this.call?.ringing?.includes(e)??!1;(null!=r||_)&&(t={type:I.ParticipantTypes.USER,...E.default.getUserStreamData(e,u?.getGuildId()),user:i,id:i.id,voiceState:r,voicePlatform:a,speaking:(0,o.getIsSpeaking)({userId:e,checkIsMuted:!0}),lastSpoke:this.lastSpoke[e]??0,soundsharing:m.default.isSoundSharing(e),ringing:_,userNick:v.default.getName(u?.getGuildId(),this.channelId,i),localVideoDisabled:g.default.isLocalVideoDisabled(i.id)},s.push(t));let y=l.default.getStreamForUser(e,u?.getGuildId())??l.default.getActiveStreamForUser(e,u?.getGuildId());if(null!=y&&y.channelId===this.channelId){let t=(0,d.encodeStreamKey)(y),a=this.getParticipant(t),o=y.ownerId===f.default.getId()&&l.default.isSelfStreamHidden(this.channelId),_=a?.type===I.ParticipantTypes.STREAM?{maxResolution:null!=a.maxResolution?{...a.maxResolution}:void 0,maxFrameRate:a.maxFrameRate}:null;n={...E.default.getUserStreamData(e,u?.getGuildId(),S.MediaEngineContextTypes.STREAM),..._,type:o?I.ParticipantTypes.HIDDEN_STREAM:I.ParticipantTypes.STREAM,id:t,userVideo:r?.selfVideo??!1,user:i,userNick:v.default.getName(u?.getGuildId(),this.channelId,i),stream:y},s.push(n)}return s}}"
    }
}