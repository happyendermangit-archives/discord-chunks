{
    "exports": {
        "DEFAULT_WANTS_FULL": {
            "any": 100
        },
        "RTCMediaSinkWantsManagerEvent": {
            "UserSSRCUpdate": "user-ssrc-update",
            "Update": "update"
        },
        "default": "class N extends o.default{constructor(e,t,n,i=new s.MediaSinkWantsLadder){var r;super(),r=this,this.userId=e,this.isStageChannel=t,this.supportsSeamless=n,this.ladder=i,this.connection=null,this.audioSsrcs={},this.videoSsrcs={},this.remoteVideoSsrcs={},this.framesReceived={},this.streamIds={},this.offscreenUsers={},this.offscreenDisabledUsers={},this.latestWants=c,this.participants=new Set,this.selectedParticipantId=null,this.pipOpen=!1,this.videoHealthManager=null,this.delayedUpdate=()=>{this.delayedCall.delay()},this.addLru=(e,t,n)=>{if(n.push(e),n.length<=3)return;let i=-1,r=-1;for(let e=0;e<n.length;e++){let o=n[e],a=t-this.offscreenUsers[o];a>i&&(i=a,r=e)}this.offscreenDisabledUsers[n[r]]=!0,n.splice(r,1)},this.updateOffscreenUsers=()=>{if(!this.connection?.getActiveOutputSinkTrackingEnabled())return;let e=Date.now(),t=[];for(let[n,i]of I.default.entries(this.streamIds))null!=i&&(this.connection?.getHasActiveVideoOutputSink(i)?(delete this.offscreenUsers[n],delete this.offscreenDisabledUsers[n]):null==this.offscreenUsers[n]?(this.offscreenUsers[n]=e,this.addLru(n,e,t)):!this.offscreenDisabledUsers[n]&&(e-this.offscreenUsers[n]>=this.getOffscreenTimeoutMs()?this.offscreenDisabledUsers[n]=!0:this.addLru(n,e,t)));if(t.length>0){let n=e+this.getOffscreenTimeoutMs();for(let e of t)n=Math.min(n,this.offscreenUsers[e]+this.getOffscreenTimeoutMs());this.offscreenTimeout.start(n-e,this.update)}else this.offscreenTimeout.stop()},this.handleLocalVideoDisabled=(e,t)=>{this.update()},this.handleLocalMute=(e,t)=>{this.update()},this.update=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=r.getWantsLevel(),n={any:t};for(let[i,o]of(r.updateOffscreenUsers(),I.default.entries(r.videoSsrcs))){let a=[],s=!1,E=o[0].ssrc;if(r.shouldReceiveFromUser(i)){let e=i===r.selectedParticipantId&&100!==t&&!r.pipOpen;if(o.length>1){for(let t of o)100===t.quality?e?(n[t.ssrc]=100,E=t.ssrc):n[t.ssrc]=0:e?n[t.ssrc]=0:E=t.ssrc;if(r.supportsSeamless&&!r.framesReceived[E])for(let e of(s=!0,a=[E],o))e.ssrc!==E&&r.framesReceived[e.ssrc]&&(100===e.quality?n[e.ssrc]=100:n[e.ssrc]=t,a.push(e.ssrc))}else e&&(n[E]=100)}else for(let e of o)n[e.ssrc]=0;for(let e of((!r.supportsSeamless||!s)&&(a=[E]),o))!a.includes(e.ssrc)&&delete r.framesReceived[e.ssrc];(e.includes(i)||void 0!==r.remoteVideoSsrcs[i]&&!(0,_.default)(r.remoteVideoSsrcs[i],a))&&(r.remoteVideoSsrcs[i]=[...a],r.emit(\"user-ssrc-update\",i,r.audioSsrcs[i],a))}for(let[e,t]of Object.entries(r.audioSsrcs))r.connection?.getLocalMute(e)&&(n[t]=0);return A?r.latestWants:(null!=r.connection&&!(0,_.default)(r.latestWants,n)&&(r.latestWants=n,r.emit(\"update\",n)),n)},this.delayedCall=new E.DelayedCall(100,this.update),this.offscreenTimeout=new E.Timeout}getWantsLevel(){let e=this.getVideoParticipantCount();return this.ladder.getMaxSinkValue(e)}userVideoDisabled(e){return this.offscreenDisabledUsers[e]}shouldReceiveFromUser(e){return!(this.connection?.getLocalVideoDisabled(e)||this.userVideoDisabled(e)&&this.videoHealthManager?.getCurrentVideoToggleState(e)!==T.VideoToggleState.AUTO_PROBING)}getAudioSSRCs(){return this.audioSsrcs}setConnection(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1];this.connection?.removeListener(a.BaseConnectionEvent.LocalVideoDisabled,this.handleLocalVideoDisabled),this.connection?.removeListener(a.BaseConnectionEvent.LocalMute,this.handleLocalMute),this.connection?.removeListener(a.BaseConnectionEvent.ActiveSinksChange,this.delayedUpdate),this.connection=e,this.connection?.addListener(a.BaseConnectionEvent.LocalVideoDisabled,this.handleLocalVideoDisabled),this.connection?.addListener(a.BaseConnectionEvent.LocalMute,this.handleLocalMute),this.connection?.addListener(a.BaseConnectionEvent.ActiveSinksChange,this.delayedUpdate),t&&this.update()}setAudioSSRC(e,t){return t>0?this.audioSsrcs[e]=t:delete this.audioSsrcs[e],this.update()}setVideoSSRCs(e,t){let n=t.filter(e=>e.active&&(e.ssrc??0)>0).map(e=>({quality:e.quality??100,ssrc:e.ssrc}));if(n.length>0)this.videoSsrcs[e]=n,this.participants.add(e);else{if(void 0!==this.videoSsrcs[e])for(let{ssrc:t}of this.videoSsrcs[e])delete this.framesReceived[t];delete this.remoteVideoSsrcs[e],delete this.videoSsrcs[e],this.participants.delete(e),this.emit(\"user-ssrc-update\",e,this.audioSsrcs[e],[])}return this.update(Array.from(this.participants))}setFirstFrameReceived(e){return this.framesReceived[e]=!0,this.update()}setStreamId(e,t){return null!=t?this.streamIds[e]=t:delete this.streamIds[e],this.update()}destroyUser(e){return delete this.audioSsrcs[e],delete this.videoSsrcs[e],this.participants.delete(e),delete this.streamIds[e],this.update(Array.from(this.participants))}reset(){this.setConnection(null,!1),this.audioSsrcs={},this.videoSsrcs={},this.remoteVideoSsrcs={},this.framesReceived={},this.streamIds={},this.latestWants=c}setSelectedParticipant(e){if(e===this.selectedParticipantId)return this.latestWants;let t=[];if(null!=this.selectedParticipantId&&this.selectedParticipantId!==this.userId&&t.push(this.selectedParticipantId),null!=e){if(this.participants.has(e))this.selectedParticipantId=e,t.push(e);else{if(this.userId!==e)return console.warn(`Participant not found: ${e}`),this.latestWants;this.selectedParticipantId=e}}else this.selectedParticipantId=null;return this.update(t.filter(e=>this.videoSsrcs[e]?.length>1))}setPipOpen(e){return(this.pipOpen=e,null!=this.selectedParticipantId)?this.update([this.selectedParticipantId]):this.latestWants}setAppBackgrounded(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];for(let[n,i]of I.default.entries(this.streamIds))if(this.offscreenDisabledUsers[n]=e,null!=i){let n=!e||t;this.connection?.setHasActiveVideoOutputSink(i,n)}return this.update()}getOffscreenDisabledUsers(){return this.offscreenDisabledUsers}getVideoParticipantCount(){let e=0;for(let t of Object.keys(this.videoSsrcs))!this.connection?.getLocalVideoDisabled(t)&&e++;return e}getOffscreenTimeoutMs(){return this.isStageChannel?S:d}}"
    }
}