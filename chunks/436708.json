{
    "exports": {
        "StreamRTCAnalyticsContext": "class D{constructor({streamRegion:e,streamApplication:t,streamSourceType:n,actionContext:s,numViewers:i,isBroadcast:r=!1}){this.streamRegion=e,this.streamApplication=t,this.streamSourceType=n,this.actionContext=s,this.maxViewers=i,this.isBroadcast=r}setActionContext(e){this.actionContext=e}trackViewerCount(e){this.maxViewers=Math.max(e,this.maxViewers)}}",
        "default": "class O extends o.default{constructor({sessionId:e,streamKey:t,serverId:n,initialLayout:s,analyticsContext:r,isStreamer:o,parentMediaSessionId:u}){let d=(0,T.decodeStreamKey)(t),{guildId:l,channelId:f}=d;super({userId:c.default.getId(),sessionId:e,guildId:l,channelId:f,context:N.MediaEngineContextTypes.STREAM,rtcServerId:n,parentMediaSessionId:u}),this._streamContext=d,this._streamKey=t,this._isStreamer=o,this._videoStreamStats=new I.default(s,this.isOwner),this.analyticsContext=r,this._updateVideoStreamId=i().debounce((e,t)=>{let{guildId:n,channelId:s,ownerId:i}=(0,T.decodeStreamKey)(this._streamKey);a.default.wait(()=>a.default.dispatch({type:\"RTC_CONNECTION_VIDEO\",guildId:n,channelId:s,userId:i,streamId:e,rtcServerId:t,context:N.MediaEngineContextTypes.STREAM}))},200),this._videoStreamStats.start(),this._initializeEvents()}get isOwner(){let{ownerId:e}=this._streamContext;return c.default.getId()===e}destroy(e){this._videoStreamStats.stop(),this._trackVideoEndStats(e),this._updateVideoStreamId.cancel(),this._updateVideoStreamId(null,null),this._updateVideoStreamId.flush(),super.destroy()}streamUpdate(e){let t=this._videoQuality;null!=t&&(e?t.pause():t.resume())}layoutChange(e){this._videoStreamStats.layoutChange(e)}getVideoStats(){let{ownerId:e}=this._streamContext,t=this._videoQuality;if(null!=t){let{duration:n,avg_bitrate:s,avg_fps:i,avg_resolution:r}=this.isOwner?t.getOutboundStats()[0]:t.getInboundStats(e)??{};return{duration:n,avg_bitrate:s,avg_fps:i,avg_resolution:r}}return null}getRegion(){return this.analyticsContext.streamRegion}getMaxViewers(){return this.analyticsContext.maxViewers}_initializeEvents(){let e=!1;this.on(u.RTCConnectionEvent.State,(e,t,n)=>{a.default.wait(()=>a.default.dispatch({type:\"RTC_CONNECTION_STATE\",state:e,...t,...n,streamKey:this._streamKey})),e===A.RTCConnectionStates.RTC_CONNECTED&&this._connection?.on(r.BaseConnectionEvent.ScreenshareFinish,(e,t,n,s,i,r,a,o,u,d,l,f,_,c)=>{let g=this.getMediaSessionId(),m=this.getRTCConnectionId(),h=this.getGoLiveSource();v.getSystemAnalyticsInfo().then(E=>{let p=null;if(null!=E){let{cpu_brand:e,cpu_vendor:t,cpu_memory:n,gpu_brand:s,gpu_memory:i}=E;p={cpu_brand:e,cpu_vendor:t,cpu_memory:n,gpu_brand:s,gpu_memory:i}}let v=(e??0)+(t??0)+(n??0)+(s??0)+(i??0)+(r??0)+(o??0)+(c??0)+(_??0);y.default.track(A.AnalyticEvents.SCREENSHARE_FINISHED,{screenshare_frames:e,videohook_frames:t,hybrid_dxgi_frames:n,hybrid_gdi_frames:s,hybrid_videohook_frames:i,hybrid_graphics_capture_frames:r,hybrid_capture_method_switches:a,quartz_frames:o,screencapturekit_frames:c,go_live_camera_frames:_,total_frames:v,desktop_capturer_type:u,media_session_id:g,rtc_connection_id:m,context:N.MediaEngineContextTypes.STREAM,screens:d,windows:l,activity:f,...p,...S.default(h?.desktopSource)})})})}),this.on(u.RTCConnectionEvent.Video,(t,n,s,i,r)=>{let a=(0,T.decodeStreamKey)(this._streamKey);a.guildId===t&&a.channelId===n&&a.ownerId===s&&(null!=this.getMediaSessionId()&&!e&&(this._trackVideoStartStats(),e=!0),this._updateVideoStreamId(i,r))}),this.on(u.RTCConnectionEvent.VideoSourceQualityChanged,(e,t,n,s,i,r)=>{a.default.wait(()=>a.default.dispatch({type:\"MEDIA_ENGINE_VIDEO_SOURCE_QUALITY_CHANGED\",guildId:e,channelId:t,senderUserId:n,maxResolution:s,maxFrameRate:i,context:r}))})}_getStreamAnalyticsProperties(){let{streamRegion:e,streamApplication:t,streamSourceType:n,actionContext:s,isBroadcast:i}=this.analyticsContext,{ownerId:r,guildId:a}=this._streamContext,o=p.default.getRegion(E.default.getHostname()),u=_.BroadcastAutoBroadcast.getSetting();return{channel_id:this.channelId,rtc_connection_id:this.getRTCConnectionId(),media_session_id:this.getMediaSessionId(),parent_media_session_id:this.parentMediaSessionId,sender_user_id:r,context:N.MediaEngineContextTypes.STREAM,guild_id:a,stream_region:e,stream_source_type:n,guild_region:o,participant_type:this.isOwner?\"streamer\":\"receiver\",share_application_name:null!=t?t.name:null,share_application_id:null!=t?t.id:null,share_application_executable:null!=t?t.exe:null,video_layout:this._videoStreamStats.getLayout(),client_event_source:s,is_broadcast:i,auto_broadcast_enabled:this.isOwner?u:null}}_trackVideoStartStats(){let e=this.isOwner?(0,C.default)():null;y.default.track(A.AnalyticEvents.VIDEO_STREAM_STARTED,{...this._getStreamAnalyticsProperties(),...e,connection_type:h.default.getType(),effective_connection_speed:h.default.getEffectiveConnectionSpeed(),service_provider:h.default.getServiceProvider()})}_trackVideoEndStats(e){let t=g.default.getChannel(this.channelId),n=null!=t?t.type:null,{ownerId:s}=this._streamContext,i=null,r=null,a=null,o=this._videoQuality;null!=o&&(i=this.isOwner?o.getOutboundStats()[0]:o.getInboundStats(s),r=o.getNetworkStats(),a=this.isOwner?o.getCodecUsageStats(\"streamer\",this.userId):o.getCodecUsageStats(\"receiver\",s));let u=(0,d.areClipsEnabled)(),_=l.default.getSettings(),c=this.isOwner?{clips_enabled:_.clipsEnabled&&u,clips_buffer_length:_.clipsLength}:{},h=this.isOwner?{bandwidth_estimation_experiment:this.getBandwidthEstimationExperiment()}:{};y.default.track(A.AnalyticEvents.VIDEO_STREAM_ENDED,{...i,...a,...r,...this._videoStreamStats.getStats(),...this._soundshareStats.getStats(),...this._getStreamAnalyticsProperties(),...c,...h,channel_type:n,reason:e,max_viewers:this.analyticsContext.maxViewers,hostname:this.hostname,hardware_enabled:m.default.getHardwareH264(),device_performance_class:this.isOwner?(0,f.getMediaPerformanceClass)():null})}_getExtraConnectionOptions(){return{streamUserId:(0,T.decodeStreamKey)(this._streamKey).ownerId}}}"
    }
}