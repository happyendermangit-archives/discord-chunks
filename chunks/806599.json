{
    "exports": {
        "default": "class d extends i.EventEmitter{constructor(e,t=\"POST\",n){super(),this._token=\"\",this._lastUpdate=0,this._loaded=0,this._aborted=!1,this._errored=!1,this._raiseEndpointErrors=!1,this.alreadyStarted=!1,this._handleStart=e=>{this._cancel=e,!this.alreadyStarted&&this.emit(\"start\",this._file),this.alreadyStarted=!0},this._handleProgress=(e,t,n)=>{let i=Date.now(),a=(0,r.calculateProgress)(e,t),s=Math.floor((e-this._loaded)/((i-this._lastUpdate)/1e3));null!=n&&this._file.items?.forEach(e=>{e.item.progress=n[e.id]}),this._lastUpdate=i,this._loaded=e,this._file={...this._file,currentSize:t,progress:a,rate:s},this.emit(\"progress\",this._file)},this._handleException=e=>{this._handleError({reason:{type:o.FileUploadErrorTypes.ERROR_SOURCE_UNKNOWN,msg:e.toString()}})},this._handleAborted=()=>{this.clearProcessingMessageInterval()},this._handleError=e=>{let{code:t,reason:n,body:i}=e;this.clearProcessingMessageInterval(),!this._aborted&&(this._errored=!0,u.log(`_handleError: ${t} (${JSON.stringify(n)}) for ${this.id}`),this.emit(\"error\",this._file,t,i,n),this.removeAllListeners())},this._handleComplete=e=>{this.clearProcessingMessageInterval(),u.log(`_handleComplete for ${this.id}`),this.emit(\"complete\",this._file,e),this.removeAllListeners()},this.id=s().uniqueId(\"Uploader\"),this._url=e,this._method=t,this._raiseEndpointErrors=n?.raiseEndpointErrors??!1}_addAttachmentsToPayload(e,t,n){let i={...e},a=[...s().get(i,t,[]),...n];return s().set(i,t,a)}clearProcessingMessageInterval(){null!=this.processingMessageChangeInterval&&(clearInterval(this.processingMessageChangeInterval),this.processingMessageChangeInterval=void 0)}cancel(){u.log(`cancel() for ${this.id}`),this._aborted=!0,null!=this._cancel&&this._cancel(),this._handleComplete()}cancelItem(e){throw Error(\"cancelItem() is not implemented on UploaderBase; must implement cancelItem() on subclass\")}upload(e,t,n){if(null!=this._cancel)throw Error(\"Uploader.upload(...): An upload is already in progress.\");this._lastUpdate=Date.now(),this._loaded=0,this._file={id:this.id,name:e.name,currentSize:0,totalPreCompressionSize:0,compressionProgress:0,progress:0,rate:0,hasImage:!1,hasVideo:!1,attachmentsCount:0,draftContent:t?.content,channelId:t?.channel_id,items:n}}}"
    }
}