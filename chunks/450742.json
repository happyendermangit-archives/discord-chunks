{
    "exports": {
        "default": "function s(e,t){let{apply:n,deleteBackward:s,deleteForward:r,deleteFragment:o,insertData:u,insertText:d,onChange:c}=e;function f(n){let a=i.HistoryUtils.currentEntry(e);if(null!=a&&(a.mergeable=!1),n>=e.history.stack.length)return;e.history.index=n;let s=i.HistoryUtils.currentEntry(e);t({newValue:s.value,newSelection:s.selection})}e.history={index:0,stack:[]},e.onChange=()=>{let{history:t}=e;0===t.stack.length&&(t.stack=[l(e)],t.index=0),null!=e.selection&&(i.HistoryUtils.currentEntry(e).selection=e.selection),m=null,c()},e.undo=()=>{e.history.index>0&&f(e.history.index-1)},e.redo=()=>{e.history.index<e.history.stack.length-1&&f(e.history.index+1)};let p=null,m=null,h=null;return e.apply=t=>{let{history:s}=e;n(t);let r=a.EditorUtils.richValue(e);r!==h&&(0===s.stack.length&&(s.stack=[l(e)],s.index=0),i.HistoryUtils.isSaving(e)&&(function(e,t,n){let a;let{selection:s}=e,l=i.HistoryUtils.currentEntry(e),r=!0,o=!0;if(\"insert_text\"===t.type&&1===t.text.length?(a=\"insert\",o=!((\"\"===t.text||t.text.endsWith(\" \"))&&n?.type===\"insert_text\"&&!(\"\"===n.text&&n.text.endsWith(\" \")))):\"split_node\"===t.type?a=\"insert\":\"remove_text\"===t.type&&1===t.text.length?a=\"delete\":(a=\"other\",r=!1,o=!1),\"set_selection\"===t.type&&null!=l){l.selection=s;return}r&&function(e,t){return!(e?.type!==t||Date.now()-e.createdAt>=4e3)&&!0}(l,a)?i.HistoryUtils.insertOrMergeEntry(e,a,o):i.HistoryUtils.insertEntry(e,a,o)}(e,t,p),p=t),m=t,h=r)},e.deleteBackward=t=>{i.HistoryUtils.withSingleEntry(e,()=>s(t))},e.deleteForward=t=>{i.HistoryUtils.withSingleEntry(e,()=>r(t))},e.deleteFragment=t=>{i.HistoryUtils.withSingleEntry(e,()=>o(t))},e.insertText=t=>{1===t.length&&m?.type===\"remove_text\"?i.HistoryUtils.withMergedEntry(e,()=>d(t)):null!=e.selection&&a.RangeUtils.isExpanded(e.selection)?i.HistoryUtils.withSingleEntry(e,()=>d(t)):d(t)},e.insertData=t=>{m?.type===\"remove_text\"?i.HistoryUtils.withMergedEntry(e,()=>u(t)):i.HistoryUtils.withSingleEntry(e,()=>u(t))},e}"
    }
}