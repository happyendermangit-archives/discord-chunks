{
    "exports": {
        "default": "class S extends s.AnalyticsFeedItemSeenManager{constructor({loadId:e,homeSessionId:t,guildId:n,windowId:s,isPaused:S}){super({windowId:s,isPaused:S,id:d(n)}),this.onInitialize=()=>{r.default.subscribe(\"GUILD_FEED_ITEM_READ_ACK\",this.handleReadAck)},this.onTerminate=()=>{r.default.unsubscribe(\"GUILD_FEED_ITEM_READ_ACK\",this.handleReadAck)},this.onFeedItemSeen=(e,t)=>{t&&(this.pendingReadAcks[e]=setTimeout(()=>{this.ackItemAsRead(e)},3e3),this.feedItemSnapshots[e]=I.default.getItem(this.guildId,e))},this.onFeedItemUnseen=(e,t)=>{e in this.pendingReadAcks&&(clearTimeout(this.pendingReadAcks[e]),delete this.pendingReadAcks[e])},this.createFlushSeenItemsFunction=e=>{let t=this.guildId,n=this.loadId,r=this.trackedFeedItems,o=this.homeSessionId,a=this.feedItemSnapshots;if(null==n||null==o)return;let s={guildId:t,loadId:n,trackedFeedItems:r,feedItemSnapshots:a,isForcedFlush:null!=e,homeSessionId:o};return()=>(function(e){let{guildId:t,loadId:n,homeSessionId:r,trackedFeedItems:o,feedItemSnapshots:a,isForcedFlush:s}=e,l={};for(let e of Object.keys(o)){let t=o[e].computeSeenTimeDestructive(s);t>0&&(l[e]={additionalSeenTimeMillis:t})}if(0===Object.keys(l).length)return Promise.resolve();let u=[],I=[],d=[];for(let e of Object.keys(l))u.push(e),I.push(l[e].additionalSeenTimeMillis),l[e].additionalSeenTimeMillis>=1e3&&d.push(e);_.default.track(c.AnalyticEvents.FEED_ITEM_SEEN_BATCH,{guild_id:t,load_id:n,feed_item_ids:u,additional_seen_time_millis:I,home_session_id:r});let S=d.map(e=>a[e]).filter(E.isNotNullish).map(T.default).map(e=>e.id);return 0===S.length?Promise.resolve():i.default.post({url:c.Endpoints.GUILD_FEED_MARK_SEEN(t),body:{item_ids:S}})})(s)},this.ackItemAsRead=e=>{delete this.pendingReadAcks[e],!u.default.isItemSeen(this.guildId,e)&&r.default.dispatch({type:\"GUILD_FEED_ITEM_READ_ACK\",guildId:this.guildId,itemId:e})},this.handleReadAck=async e=>{let{guildId:t,itemId:n}=e;if(this.guildId!==t)return;let r=I.default.getItem(t,n);if(null==r||!r.unreadMention||r.seen)return;let s=(0,T.default)(r).channel_id;await o.default.unarchiveThreadIfNecessary(s);let _=a.default.getMentionCount(s),E=a.default.ackMessageId(s);if(null==E)return;let u=0;for(let e of(0,T.getAllMessagesFromFeedItem)(r))e.mentioned&&l.default.compare(e.id,E)>0&&(u+=1);0!==u&&i.default.post({url:c.Endpoints.MESSAGE_ACK(s,E),body:{manual:!0,mention_count:_-u}})},this.guildId=n,this.loadId=e,this.homeSessionId=t,this.pendingReadAcks={},this.feedItemSnapshots={},this.lastFlushTimeMillis=Date.now()}}",
        "getGuildFeedSeenManagerId": "function d(e){return`${s.AnalyticsFeedTypes.GUILD_HOME}_${e}`}"
    }
}