{
    "exports": {
        "default": "class extends s.default{_initialize(){C.default.addChangeListener(this.handleSelectedChannelUpdate),r.default.subscribe(\"EMBEDDED_ACTIVITY_LAUNCH_FAIL\",this.handleActivityLaunchFail),r.default.subscribe(\"EMBEDDED_ACTIVITY_OPEN\",B),r.default.subscribe(\"EMBEDDED_ACTIVITY_CLOSE\",G),r.default.subscribe(\"EMBEDDED_ACTIVITY_INBOUND_UPDATE\",H),r.default.subscribe(\"EMBEDDED_ACTIVITY_DEFERRED_OPEN\",this.handleDeferredOpen),r.default.subscribe(\"RPC_APP_DISCONNECTED\",this.handleRPCDisconnect),r.default.subscribe(\"MEDIA_SESSION_JOINED\",k)}_terminate(){C.default.removeChangeListener(this.handleSelectedChannelUpdate),r.default.unsubscribe(\"EMBEDDED_ACTIVITY_LAUNCH_FAIL\",this.handleActivityLaunchFail),r.default.unsubscribe(\"EMBEDDED_ACTIVITY_OPEN\",B),r.default.unsubscribe(\"EMBEDDED_ACTIVITY_CLOSE\",G),r.default.unsubscribe(\"EMBEDDED_ACTIVITY_INBOUND_UPDATE\",H),r.default.unsubscribe(\"EMBEDDED_ACTIVITY_DEFERRED_OPEN\",this.handleDeferredOpen),r.default.unsubscribe(\"RPC_APP_DISCONNECTED\",this.handleRPCDisconnect),r.default.unsubscribe(\"MEDIA_SESSION_JOINED\",k)}constructor(...e){super(...e),this.handleSelectedChannelUpdate=()=>{let e=C.default.getVoiceChannelId();for(let{channelId:t,applicationId:i}of D.default.getSelfEmbeddedActivities().values())(0,b.default)(t)&&t!==e&&this.leaveActivity({channelId:t,applicationId:i});if(null!=e){let t=D.default.getEmbeddedActivitiesForChannel(e),i=I.default.getId();t.forEach(e=>{if(e.userIds.has(i)){let t=D.default.getSelfEmbeddedActivityForChannel(e.channelId);null==t&&(0,y.disconnectEmbeddedActivity)(e.channelId,e.applicationId)}})}},this.handleActivityLaunchFail=e=>{let{error:t,guildId:i}=e;if(null==i)return;let n=R.default.Messages.EMBEDDED_ACTIVITIES_LAUNCH_FAIL_GENERIC;switch(t.code){case V.AbortCodes.INVALID_ACTIVITY_LAUNCH_NO_ACCESS:n=R.default.Messages.EMBEDDED_ACTIVITIES_LAUNCH_FAIL_ACCESS;break;case V.AbortCodes.INVALID_ACTIVITY_LAUNCH_PREMIUM_TIER:n=R.default.Messages.EMBEDDED_ACTIVITIES_LAUNCH_FAIL_PREMIUM;break;case V.AbortCodes.INVALID_ACTIVITY_LAUNCH_CONCURRENT_ACTIVITIES:n=R.default.Messages.EMBEDDED_ACTIVITIES_LAUNCH_FAIL_CONCURRENT;break;case V.AbortCodes.INVALID_PERMISSIONS:n=R.default.Messages.EMBEDDED_ACTIVITIES_INVALID_PERMISSIONS;break;case V.AbortCodes.INVALID_ACTIVITY_LAUNCH_AFK_CHANNEL:n=R.default.Messages.EMBEDDED_ACTIVITIES_INVALID_CHANNEL;break;case V.AbortCodes.INVALID_ACTIVITY_LAUNCH_AGE_GATED:n=R.default.Messages.EMBEDDED_ACTIVITIES_LAUNCH_FAIL_AGE_GATE;break;case V.AbortCodes.INVALID_ACTIVITY_LAUNCH_DEV_PREVIEW_GUILD_SIZE:n=R.default.Messages.EMBEDDED_ACTIVITIES_LAUNCH_FAIL_GUILD_SIZE}this.showLaunchErrorModal(n)},this.superHandleRPCDisconnect=e=>{let{reason:t,application:i}=e,n=i.id;if(null!=n&&null!=t){for(let{applicationId:e,channelId:t}of D.default.getSelfEmbeddedActivities().values())e===n&&this.leaveActivity({channelId:t,applicationId:n});t.code!==V.RPCCloseCodes.CLOSE_NORMAL&&this.showErrorModal(t,n)}},this.handleDeferredOpen=async e=>{var t,i,n;let l;let{channelId:a,applicationId:u,analyticsLocations:r}=e,d=A.default.getChannel(a);if(void 0===d||E.GUILD_VOCAL_CHANNEL_TYPES.has(null==d?void 0:d.type)&&C.default.getVoiceChannelId()!==a)return;let s=D.default.getSelfEmbeddedActivityForChannel(a);if((null==s?void 0:s.applicationId)===u)return;let f=await o.default.fetchApplication(u),_=(0,L.getIsActivitiesEnabledForCurrentPlatform)(d);if(!_){this.showLaunchErrorModal(R.default.Messages.EMBEDDED_ACTIVITIES_NOT_AVAILABLE_ON_OS);return}if(!(0,M.default)(null==f?void 0:null===(t=f.embedded_activity_config)||void 0===t?void 0:t.supported_platforms)){this.showLaunchErrorModal(R.default.Messages.EMBEDDED_ACTIVITIES_APPLICATION_UNSUPPORTED_OS);return}let I=null==s?void 0:s.applicationId;null!=I&&(await o.default.fetchApplication(I),l=c.default.getApplication(I));let T=null!==(i=null==d?void 0:d.getGuildId())&&void 0!==i?i:void 0,{activityConfigs:v,applications:S}=await (0,y.fetchShelf)({guildId:T}),N=(0,p.default)({applicationId:u,activityConfigs:v,applications:S});if(null==N){let e=await (0,y.fetchShelf)({guildId:T,force:!0});N=(0,p.default)({applicationId:u,activityConfigs:e.activityConfigs,applications:e.applications})}let h=D.default.getEmbeddedActivitiesForChannel(a).find(e=>e.applicationId===u),m=null!==(n=null==h?void 0:h.userIds.size)&&void 0!==n?n:0;m>0?(0,O.maybeJoinEmbeddedActivity)({channelId:a,applicationId:u,instanceId:null==h?void 0:h.instanceId,inputApplication:null,analyticsLocations:r,embeddedActivitiesManager:this}):await (0,g.default)({activityItem:N,currentActivity:l,channelId:a,guildId:T,embeddedActivitiesManager:this,analyticsLocations:r})}}}"
    }
}