{
    "exports": {
        "default": "class h extends o.default{handleRTCConnectionState(e){let{context:t,state:n,streamKey:r}=e;if(!(0,d.areClipsEnabled)()||n!==R.RTCConnectionStates.RTC_CONNECTED)return;let o=E.default.getId();if(t===i.MediaEngineContextTypes.DEFAULT)return this.applyUserVoiceRecording(o);if(t===i.MediaEngineContextTypes.STREAM&&null!=r){let{ownerId:e}=(0,s.decodeStreamKey)(r);if(e!==o)return;let t=I.default.getRTCConnection(r);if(null==t)return;this.applyStreamRecording(o,t)}}handleRTCUserCreate(e){let{userId:t,context:n}=e;n===i.MediaEngineContextTypes.DEFAULT&&this.applyUserVoiceRecording(t)}handleRTCConnectionFlags(e){let{userId:t,channelId:n,guildId:i}=e;this.maybeShowClipsWarning(t),this.applyUserVoiceRecording(t);let r=I.default.getRTCConnection(s.encodeStreamKey({streamType:null!=i?C.StreamTypes.GUILD:C.StreamTypes.CALL,ownerId:t,channelId:n,guildId:i}));null!=r&&this.applyStreamRecording(t,r)}handleClipsInitFailure(e){let{applicationName:t,errMsg:n}=e;T.default.track(R.AnalyticEvents.CLIPS_INIT_FAILURE,{application_name:t,error_message:n})}maybeShowClipsWarning(e){let t=u.default.getChannelId();if(!(null==t||S.default.getClipsWarningShown(t))&&e!==E.default.getId())S.default.isClipsEnabledForUser(e)&&(r.default.dispatch({type:\"CLIPS_SHOW_CALL_WARNING\",channelId:t}),this.showClipsToast())}handlePostConnectionOpen(){if(!!(0,N.default)(l.default)){if(this.applyNativeClipsSettings(),!(0,d.areClipsEnabled)()){S.default.getSettings().clipsEnabled&&this.disableClips();return}(null==S.default.getHardwareClassification()||null==S.default.getHardwareClassificationForDecoupled()||S.default.getHardwareClassificationVersion()!==O.CLIPS_HARDWARE_CLASSIFICATION_VERSION)&&this.classifyHardwareAndTrack().then(e=>{r.default.dispatch({type:\"CLIPS_CLASSIFY_HARDWARE\",classification:e})})}}handleRTCConnectionVideo(e){let{userId:t,context:n,channelId:r,guildId:o}=e;if(n!==i.MediaEngineContextTypes.STREAM||!(0,N.default)(l.default))return;let a=I.default.getRTCConnection(s.encodeStreamKey({streamType:null!=o?C.StreamTypes.GUILD:C.StreamTypes.CALL,ownerId:t,channelId:r,guildId:o}));null!=a&&this.applyStreamRecording(t,a)}async classifyHardwareAndTrack(){try{let e=await a.default.processUtils.getSystemInfo(),t=this.classifyHardware(e);return T.default.track(R.AnalyticEvents.CLIPS_HARDWARE_CLASSIFICATION,{classification:t,version:O.CLIPS_HARDWARE_CLASSIFICATION_VERSION,gpu_models:e.gpus.map(e=>{let{model:t}=e;return t})}),t}catch(e){return A.ClipsHardwareClassification.UNKNOWN}}classifyHardware(e){if((0,c.isWindows)()){let t=e.gpus.some(e=>{let{model:t}=e;return O.WINDOWS_HARDWARE_AUTO_ENABLE_GPU_REGEX.test(t)}),n=e.gpus.some(e=>{let{model:t}=e;return O.WINDOWS_HARDWARE_MINIMUM_GPU_REGEX.test(t)});return t?A.ClipsHardwareClassification.MEETS_AUTO_ENABLE:n?A.ClipsHardwareClassification.MEETS_MINIMUM:A.ClipsHardwareClassification.BELOW_MINIMUM}if((0,c.isMac)())return e.gpus.some(e=>{let{model:t}=e;return O.OSX_HARDWARE_AUTO_ENABLE_GPU_REGEX.test(t)})?A.ClipsHardwareClassification.MEETS_AUTO_ENABLE:A.ClipsHardwareClassification.MEETS_MINIMUM;return A.ClipsHardwareClassification.UNKNOWN}applyUserVoiceRecording(e){if(!(0,N.default)(l.default))return;let t=u.default.getRTCConnection();if(null==t)return;if(e===E.default.getId()){t.setClipRecordUser(e,\"audio\",S.default.getSettings().clipsEnabled);return}let n=S.default.isVoiceRecordingAllowedForUser(e);t.setClipRecordUser(e,\"audio\",n)}applyStreamRecording(e,t){if(!(0,N.default)(l.default))return;if(E.default.getId()===e){let{clipsEnabled:n}=S.default.getSettings(),i=(0,d.areClipsEnabled)();t.setClipRecordUser(e,\"audio\",i&&n),t.setClipRecordUser(e,\"video\",i&&n);return}let{enableViewerClipping:n,ignoreSenderPreference:i}=_.default.getCurrentConfig({location:\"ClipsManager:applyStreamRecording\"});if(!n)return;let r=i||S.default.isViewerClippingAllowedForUser(e);this.applyNativeClipsSettings(),t.setClipRecordUser(e,\"audio\",r),t.setClipRecordUser(e,\"video\",r)}disableClips(){}constructor(...e){super(...e),this.actions={POST_CONNECTION_OPEN:e=>this.handlePostConnectionOpen(),RTC_CONNECTION_FLAGS:e=>this.handleRTCConnectionFlags(e),RTC_CONNECTION_USER_CREATE:e=>this.handleRTCUserCreate(e),CLIPS_INIT_FAILURE:e=>this.handleClipsInitFailure(e),CLIPS_SETTINGS_UPDATE:e=>this.applyNativeClipsSettings(e),STREAM_START:()=>this.applyNativeClipsSettings(),RUNNING_GAME_TOGGLE_DETECTION:e=>this.handleClipsInitOnToggleDetection(e),RUNNING_GAMES_CHANGE:e=>this.handleClipsInitOnGamesChange(e),CLIPS_RESTART:()=>this.fireClipsInitEvent(),RTC_CONNECTION_VIDEO:e=>this.handleRTCConnectionVideo(e),RTC_CONNECTION_STATE:e=>this.handleRTCConnectionState(e),MEDIA_ENGINE_SET_HARDWARE_H264:e=>this.handleMediaEngineSetHardwareH264(e)}}}"
    }
}