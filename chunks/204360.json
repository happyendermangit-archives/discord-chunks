{
    "exports": {
        "VideoQuality": "class d extends a.default{constructor(e,t=_.TimeStampProducer){super(),this.connection=e,this.timestampProducer=t,this.networkQuality=new u.default,this.pausedCount=0,this.outboundStats={},this.inboundStats={},this.symmetricCodecUpdates=0,this.asymmetricCodecUpdates=0,this.statCollectionPausedUsers=new Set,this.sampleStats=e=>{if(null==e)return;let t=this.timestampProducer.now();if(this.networkQuality.incrementNetworkStats(t),this.updateSystemResourceStats(),this.updateVideoEffectStats(e),null==e)return;let n=this.connection.getStreamParameters();this.receivedStats(t,e,n)},this.paused=new c(!1,t),this.zeroReceivers=new c(!1,t),this.videoStopped=new c(!1,t),this.videoEffectDuration=new c(!1,t)}addUserToStatsCollectionPausedSet(e){this.statCollectionPausedUsers.add(e)}removeUserFromStatsCollectionPausedSet(e){this.statCollectionPausedUsers.delete(e)}start(){this.streamStart=this.timestampProducer.now(),this.connection.on(s.BaseConnectionEvent.Stats,this.sampleStats)}setOutboundSsrc(e){null==this.outboundStats[e]&&(this.outboundStats[e]=new I.OutboundStats(this.timestampProducer))}getOrCreateInboundStats(e){return null==this.inboundStats[e]&&(this.inboundStats[e]=new I.InboundStats(this.timestampProducer)),this.inboundStats[e]}setInboundUser(e,t){this.getOrCreateInboundStats(e).setVideoStopped(0===t,I.VideoStoppedReasons.SenderStopped)}setUserVideoDisabled(e,t){let n=this.getOrCreateInboundStats(e);n.setVideoStopped(t,I.VideoStoppedReasons.ClientSideDisableVideo),!t&&n.statsWindow.length>0&&0===n.statsWindow[0].packets&&(n.startTime=this.timestampProducer.now())}pause(){!this.paused.value&&this.pausedCount++,o().forEach(this.outboundStats,e=>{e.statsWindow=[]}),o().forEach(this.inboundStats,e=>{e.statsWindow=[]}),this.updateSendState({paused:!0})}resume(){this.updateSendState({paused:!1})}stop(){this.connection.off(s.BaseConnectionEvent.Stats,this.sampleStats),this.streamEnd=this.timestampProducer.now(),this.removeAllListeners()}getNetworkStats(){return this.networkQuality.getStats()}getEncoderUsageStats(){let e=new Map;for(let t in this.outboundStats){let n=new Map;for(let i of this.outboundStats[t].getCodecsUsed()){let r=i.toUpperCase();n.set(r,T(this.outboundStats[t].codecBuckets[r])),e.set(parseInt(t),n)}}return e}getDecoderUsageStats(){let e=new Map;for(let t in this.inboundStats){let n=new Map;for(let i of this.inboundStats[t].getCodecsUsed()){let r=i.toUpperCase();n.set(r,T(this.inboundStats[t].codecBuckets[r])),e.set(t,n)}}return e}getCodecUsageStats(e,t){let n=this.asymmetricCodecUpdates>this.symmetricCodecUpdates,i=new Map;if(\"sender\"===e||\"streamer\"===e){let e=this.getEncoderUsageStats();if(e.size>0){let t=[...e.keys()].sort()[0];i=e.get(t)}return{codec_asymmetric_session:n,codec_h264_encode_duration_sec:i.get(I.CodecTypes.H264)??0,codec_h265_encode_duration_sec:i.get(I.CodecTypes.H265)??0,codec_vp8_encode_duration_sec:i.get(I.CodecTypes.VP8)??0,codec_vp9_encode_duration_sec:i.get(I.CodecTypes.VP9)??0,codec_av1_encode_duration_sec:i.get(I.CodecTypes.AV1)??0}}{let e=this.getDecoderUsageStats();return e.has(t)&&(i=e.get(t)),{codec_asymmetric_session:n,codec_h264_decode_duration_sec:i.get(I.CodecTypes.H264)??0,codec_h265_decode_duration_sec:i.get(I.CodecTypes.H265)??0,codec_vp8_decode_duration_sec:i.get(I.CodecTypes.VP8)??0,codec_vp9_decode_duration_sec:i.get(I.CodecTypes.VP9)??0,codec_av1_decode_duration_sec:i.get(I.CodecTypes.AV1)??0}}}getOutboundStats(){let e=[];return o().forEach(this.outboundStats,(t,n)=>{let i;let r=this.connection?.getStreamParameters();r.length>1&&r.forEach(e=>{parseInt(n)===e.ssrc&&(i=e.quality??50)});let o=[1,5,10,25,50,75],a=t.vmafHistogram.getReport(o),s=t.psnrHistogram.getReport(o),_=t.targetBitrateHistogram.getReport([1,5,10,25,50,75,99]),E=t.aggregationDuration/1e3;e.push({...this.getStats(t),target_fps:E>0?Math.round((t.targetFrames??0)/E):0,target_bitrate_network:E>0?Math.round((t.targetBytesNetwork??0)*8/E):0,target_bitrate_network_percentile1:_.count>0?_.percentiles[1]:null,target_bitrate_network_percentile5:_.count>0?_.percentiles[5]:null,target_bitrate_network_percentile10:_.count>0?_.percentiles[10]:null,target_bitrate_network_percentile25:_.count>0?_.percentiles[25]:null,target_bitrate_network_percentile50:_.count>0?_.percentiles[50]:null,target_bitrate_network_percentile75:_.count>0?_.percentiles[75]:null,target_bitrate_network_percentile99:_.count>0?_.percentiles[99]:null,target_bitrate_max:E>0?Math.round((t.targetBytesMax??0)*8/E):0,duration_encoder_nvidia_cuda:T(t.encoderBuckets[I.Encoders.NVIDIA_CUDA]),duration_encoder_nvidia_direct3d:T(t.encoderBuckets[I.Encoders.NVIDIA_DIRECT_3D]),duration_encoder_openh264:T(t.encoderBuckets[I.Encoders.OPENH264]),duration_encoder_videotoolbox:T(t.encoderBuckets[I.Encoders.VIDEOTOOLBOX]),duration_encoder_amd_direct3d:T(t.encoderBuckets[I.Encoders.AMD_DIRECT_3D]),duration_encoder_intel:T(t.encoderBuckets[I.Encoders.INTEL]),duration_encoder_intel_direct3d:T(t.encoderBuckets[I.Encoders.INTEL_DIRECT_3D]),duration_encoder_vp8_libvpx:T(t.encoderBuckets[I.Encoders.VP8_LIBVPX]),duration_encoder_uncategorized:T(t.encoderBuckets[I.Encoders.UNCATEGORIZED]),duration_encoder_unknown:T(t.encoderBuckets[I.Encoders.UNKNOWN]),quality:i,average_encode_time_ms:t.averageEncodeTime,average_encoder_vmaf_score:t.vmafScoreNum>0?t.vmafScoreSum/t.vmafScoreNum:null,encoder_vmaf_score_percentile1:a.count>0?a.percentiles[1]:null,encoder_vmaf_score_percentile5:a.count>0?a.percentiles[5]:null,encoder_vmaf_score_percentile10:a.count>0?a.percentiles[10]:null,encoder_vmaf_score_percentile25:a.count>0?a.percentiles[25]:null,encoder_vmaf_score_percentile50:a.count>0?a.percentiles[50]:null,encoder_vmaf_score_percentile75:a.count>0?a.percentiles[75]:null,average_encoder_psnr_db:t.psnrDbNum>0?t.psnrDbSum/t.psnrDbNum:null,encoder_psnr_db_percentile1:s.count>0?s.percentiles[1]:null,encoder_psnr_db_percentile5:s.count>0?s.percentiles[5]:null,encoder_psnr_db_percentile10:s.count>0?s.percentiles[10]:null,encoder_psnr_db_percentile25:s.count>0?s.percentiles[25]:null,encoder_psnr_db_percentile50:s.count>0?s.percentiles[50]:null,encoder_psnr_db_percentile75:s.count>0?s.percentiles[75]:null,average_outbound_want:t.outboundSinkWantNum>0?t.outboundSinkWantSum/t.outboundSinkWantNum:null,frames_dropped_rate_limiter:t.framesDroppedRateLimiter,frames_dropped_encoder_queue:t.framesDroppedEncoderQueue,frames_dropped_congestion_window:t.framesDroppedCongestionWindow})}),e}getInboundStats(e){return this.getStats(this.inboundStats[e])}destroyUser(e){delete this.inboundStats[e]}getInboundParticipants(){return l.default.keys(this.inboundStats)}updateSendState(e){null!=e.paused&&(this.paused.value=e.paused),null!=e.receivers&&(this.zeroReceivers.value=0===e.receivers);let t=this.paused.value||this.zeroReceivers.value,n=this.videoStopped.value;this.videoStopped.value=t,t!==n&&o().forEach(this.outboundStats,e=>e.statsWindow=[])}getStats(e){if(null==e)return;let t=Number(this.streamStart),n=null!=this.streamEnd?this.streamEnd-t:this.timestampProducer.now()-t,i=Math.max(e.aggregationDuration,0)/1e3,r=[1,5,10,25,50,75],o=e.cpuHistogram.getReport(),a=e.memoryHistogram.getReport(),s=e.fpsHistogram.getReport(r),_=e.bitrateHistogram.getReport([1,5,10,25,50,75,99]),E=e.resolutionHistogram.getReport(r),l={duration:Math.floor(n/1e3),duration_aggregation:T(i),duration_stopped_receiving:T(e.videoStoppedDuration.asSeconds()),duration_stream_under_8mbps:T(e.bitrateBuckets[8e6]),duration_stream_under_7mbps:T(e.bitrateBuckets[7e6]),duration_stream_under_6mbps:T(e.bitrateBuckets[6e6]),duration_stream_under_5mbps:T(e.bitrateBuckets[5e6]),duration_stream_under_4mbps:T(e.bitrateBuckets[4e6]),duration_stream_under_3mbps:T(e.bitrateBuckets[3e6]),duration_stream_under_2mbps:T(e.bitrateBuckets[2e6]),duration_stream_under_1_5mbps:T(e.bitrateBuckets[15e5]),duration_stream_under_1mbps:T(e.bitrateBuckets[1e6]),duration_stream_under_0_5mbps:T(e.bitrateBuckets[5e5]),duration_stream_at_0mbps:T(e.bitrateBuckets[0]),duration_fps_under_60:T(e.fpsBuckets[60]),duration_fps_under_55:T(e.fpsBuckets[55]),duration_fps_under_50:T(e.fpsBuckets[50]),duration_fps_under_45:T(e.fpsBuckets[45]),duration_fps_under_40:T(e.fpsBuckets[40]),duration_fps_under_35:T(e.fpsBuckets[35]),duration_fps_under_30:T(e.fpsBuckets[30]),duration_fps_under_25:T(e.fpsBuckets[25]),duration_fps_under_20:T(e.fpsBuckets[20]),duration_fps_under_15:T(e.fpsBuckets[15]),duration_fps_under_10:T(e.fpsBuckets[10]),duration_fps_under_5:T(e.fpsBuckets[5]),duration_fps_at_0:T(e.fpsBuckets[0]),avg_resolution:e.intervalTotal>0?Math.round(e.resolutionTotal/e.intervalTotal):0,avg_minor_resolution:e.intervalTotal>0?Math.round(e.minorResolutionTotal/e.intervalTotal):0,avg_major_resolution:e.intervalTotal>0?Math.round(e.majorResolutionTotal/e.intervalTotal):0,duration_resolution_under_720:T(e.resolutionBuckets[720]),duration_resolution_under_480:T(e.resolutionBuckets[480]),duration_resolution_under_360:T(e.resolutionBuckets[360]),num_pauses:this.pausedCount,duration_paused:T(this.paused.totalDuration()/1e3),duration_zero_receivers:T(this.zeroReceivers.totalDuration()/1e3),duration_video_stopped:T(this.videoStopped.totalDuration()/1e3),client_performance_cpu_percentile25:o.percentiles[25],client_performance_cpu_percentile50:o.percentiles[50],client_performance_cpu_percentile75:o.percentiles[75],client_performance_cpu_percentile90:o.percentiles[90],client_performance_cpu_percentile95:o.percentiles[95],client_performance_memory_percentile25:a.percentiles[25],client_performance_memory_percentile50:a.percentiles[50],client_performance_memory_percentile75:a.percentiles[75],client_performance_memory_percentile90:a.percentiles[90],client_performance_memory_percentile95:a.percentiles[95],client_performance_memory_min:a.min,client_performance_memory_max:a.max,fps_percentile1:s.percentiles[1],fps_percentile5:s.percentiles[5],fps_percentile10:s.percentiles[10],fps_percentile25:s.percentiles[25],fps_percentile50:s.percentiles[50],fps_percentile75:s.percentiles[75],bitrate_percentile1:_.percentiles[1],bitrate_percentile5:_.percentiles[5],bitrate_percentile10:_.percentiles[10],bitrate_percentile25:_.percentiles[25],bitrate_percentile50:_.percentiles[50],bitrate_percentile75:_.percentiles[75],bitrate_percentile99:_.percentiles[99],resolution_percentile1:E.percentiles[1],resolution_percentile5:E.percentiles[5],resolution_percentile10:E.percentiles[10],resolution_percentile25:E.percentiles[25],resolution_percentile50:E.percentiles[50],resolution_percentile75:E.percentiles[75],duration_video_effect:T(this.videoEffectDuration.totalDuration()/1e3),cryptor_max_attempts:e.cryptorMaxAttempts},{bytes:u,framesDropped:I,framesCodecError:c,framesCodec:d,framesNetwork:S,packets:A,packetsLost:N,nackCount:O,pliCount:R,qpSum:C,pauseCount:h,freezeCount:L,totalPausesDuration:D,totalFreezesDuration:m,totalFramesDuration:p,keyframes:f,passthroughCount:P,cryptorSuccessCount:M,cryptorFailureCount:U,cryptorDuration:g,cryptorAttempts:G}=e.aggregatedProperties;return{...l,avg_bitrate:i>0?Math.round((u??0)*8/i):0,avg_fps:i>0?Math.round((d??0)/i):0,num_bytes:u,num_packets_lost:N,num_packets:A,num_frames:S,num_frames_codec_error:c,time_to_first_frame_ms:e.timeToFirstFrame,num_frames_dropped:I,num_nacks:O,num_plis:R,qp_sum:C,receiver_pause_count:h,receiver_freeze_count:L,receiver_total_pauses_duration:D,receiver_total_freezes_duration:m,receiver_total_frames_duration:p,num_keyframes:f,cryptor_passthrough_count:P,cryptor_success_count:M,cryptor_failure_count:U,cryptor_duration:g,cryptor_attempts:G}}receivedStats(e,t,n){let i=t.transport,r=(0,E.isWeb)()?1:i.receiverReports?.length??0,a=new Set,s=new Set;if(this.updateSendState({receivers:r}),t.rtp.outbound.filter(e=>\"video\"===e.type).forEach(t=>{if(null!=t){let r=t.ssrc,o=this.outboundStats[r];if(null==o&&(console.warn(`Unknown outbound video stream with SSRC: ${r}`),o=new I.OutboundStats(this.timestampProducer),this.outboundStats[r]=o),null==o.timeToFirstFrame&&(t.framesEncoded>0||(t.frameRateInput??0)>0)&&(o.timeToFirstFrame=Math.max(0,e-o.startTime)),!this.videoStopped.value){o.appendAndIncrementStats(I.RawVideoStats.parseOutboundStats(t,e)),o.encoderCodec!==I.CodecTypes.UNKNOWN&&a.add(o.encoderCodec);let s=n.find(e=>e.ssrc===r)?.maxBitrate;o.appendTargetRates(n.find(e=>e.ssrc===r)?.maxFrameRate,t.bitrateTarget??Math.min(i.availableOutgoingBitrate??0,s??0),s),o.averageEncodeTime=t.averageEncodeTime??0,o.framesDroppedRateLimiter=t.framesDroppedRateLimiter??null,o.framesDroppedEncoderQueue=t.framesDroppedEncoderQueue??null,o.framesDroppedCongestionWindow=t.framesDroppedCongestionWindow??null}}}),!this.paused.value&&o().forEach(t.rtp.inbound,(t,n)=>{let i=t.find(e=>\"video\"===e.type);if(null!=i){let t=this.inboundStats[n];null==t&&(console.warn(`Unknown inbound video stream for user: ${n}`),t=new I.InboundStats(this.timestampProducer),this.inboundStats[n]=t);let r=I.RawVideoStats.parseInboundStats(i,e);!this.statCollectionPausedUsers.has(n)&&t.appendAndIncrementStats(r),r.packets>0&&this.emit(\"fps-update\",n,r.framesCodec,r.timestamp),t.decoderCodec!==I.CodecTypes.UNKNOWN&&s.add(t.decoderCodec),null==t.timeToFirstFrame&&i.framesDecoded>0&&(t.timeToFirstFrame=e-t.startTime)}}),0!==a.size&&0!==s.size){var _,l;if(_=a,l=s,_.size===l.size&&Array.from(_).every(e=>l.has(e)))this.symmetricCodecUpdates++;else this.asymmetricCodecUpdates++}}updateSystemResourceStats(){for(let e in this.outboundStats)this.outboundStats[e].addSystemResources();for(let e in this.inboundStats)this.inboundStats[e].addSystemResources()}updateVideoEffectStats(e){let t=e?.rtp.outbound.find(e=>\"video\"===e.type);this.videoEffectDuration.value=t?.type===\"video\"&&null!=t.filter}}",
        "VideoQualityEvent": {
            "FpsUpdate": "fps-update"
        }
    }
}