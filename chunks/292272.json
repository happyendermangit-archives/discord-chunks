{
    "exports": {
        "GuildMemberSafetyPageStore": "class h{constructor(e){this.lastRefreshTimestamp=0,this.lastCursorTimestamp=Date.now(),this._lastRefreshTimer=null,this.guildId=e,this._initialized=!1,this._members=null,this._pagination=null,this._search=null}getSearchIndex(){return null==this._search||this._search.hasDefaultQuery?l.MemberSafetySecondaryIndex.CURRENT_GUILD_MEMBER:l.MemberSafetySecondaryIndex.INCLUDED_IN_SEARCH_RESULTS}initialize(){if(this._initialized){this.lastCursorTimestamp=Date.now();return}this._initialized=!0,this._search=new d.GuildMemberSafetySearch(this.guildId),this._members=new l.GuildMemberSafetyMembers(this.guildId),this._pagination=new o.GuildMemberSafetyPagination(this.guildId,this._members.values(this.getSearchIndex()))}get isInitialized(){return this._initialized}reset(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._initialized&&(this._members?.reset(),this._pagination?.reset(),this._search?.reset(),e&&this.initialize())}get searchChunkSize(){return null!=this._pagination&&this._initialized?(0,o.getSearchChunkLimit)(this._pagination.getPaginationState()):0}getMember(e){return null!=this._members&&this._initialized?this._members.getMemberByUserId(e)??null:null}getMembersByIndex(e){return null!=this._members&&this._initialized?[this._members.values(e),this._members.version]:[[],0]}countMembersByIndex(e){return null!=this._members&&this._initialized?this._members.count(e):0}_checkUpdatesForPaginationUpdate(e,t){return null!=t.isIncludedInSearchResults&&t.isIncludedInSearchResults!==e.isIncludedInSearchResults||null!=t.isCurrentGuildMemberByTimestamp&&t.isCurrentGuildMemberByTimestamp!==e.isCurrentGuildMemberByTimestamp||!1}_getIsIncludedInSearch(e,t){if(null==this._search||this._search.hasDefaultQuery)return[!1,!1];let r={...e,...t},n=this._search.isMemberIncludedInSearchResults(r),i=n!==e.isIncludedInSearchResults;return[n,i]}updatePaginationChunks(){if(null==this._pagination||null==this._members||!this._initialized)return!1;let e=this._members.values(this.getSearchIndex());return this._pagination.updateSortedMembers(e)}removeMember(e){if(null==this._members||!this._initialized||null==this._members.getMemberByUserId(e))return!1;let t=this._members.removeMember(e);return t?this.updatePaginationChunks():t}_rawUpdateMember(e,t){if(null==this._members)return[!1,!1];let r=!1,n=this._members.getMemberByUserId(e);if(null==n){r=!0;let a=i.default.getTrueMember(this.guildId,e);if(null==a)return[!1,!1];n=this._members.enhanceNewMember(a,this.getSearchState(),t)}if(null==t.isIncludedInSearchResults){let[e,i]=this._getIsIncludedInSearch(n,t);i&&(r=!0,t.isIncludedInSearchResults=e)}else t.isIncludedInSearchResults!==n.isIncludedInSearchResults&&(r=!0);let a=this._members.updateMember(n,t);return!r&&(r=this._checkUpdatesForPaginationUpdate(n,t)),[r,a]}isMemberInIndex(e){return null!=this._members&&!!this._initialized&&this._members._membersMap.has(e)}isMemberIncludedInSearchResults(e){if(null==this._members||null==this._search||null==this._pagination||!this._initialized)return!1;if(this._search.hasDefaultQuery)return this._pagination.isMemberInAnyChunk(e);let t=this._members.getMemberByUserId(e);if(null==t){let r=i.default.getTrueMember(this.guildId,e);if(null==r)return!1;t=this._members.enhanceNewMember(r,this.getSearchState())}else if(t.isIncludedInSearchResults)return!0;return this._search.isMemberIncludedInSearchResults(t)}updateMember(e,t){if(null==this._members||!this._initialized)return!1;let[r,n]=this._rawUpdateMember(e,t);return r?this.updatePaginationChunks():n}updateClientMembers(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(null==this._members||!this._initialized)return!1;let n=!1,i=!1;for(let a of e){if(null==a.joinedAt)continue;let e=a;if(t&&(e={...e,isIncludedInSearchResults:!0}),r){let t=(0,s.getJoinedAtTimestamp)(a.joinedAt);e={...e,isCurrentGuildMemberByTimestamp:t<=this._members.newMemberTimestamp,refreshTimestamp:this.lastRefreshTimestamp}}let[u,l]=this._rawUpdateMember(a.userId,e);n=u||n,i=l||i}return n?this.updatePaginationChunks():i}updateServerMembers(e){if(null==this._members||!this._initialized)return!1;let t=!1,r=!1;for(let n of e){let e=i.default.getTrueMember(this.guildId,n.user.id);if(null==e)continue;let[a,u]=this._rawUpdateMember(n.user.id,e);t=a||t,r=u||r}return t?this.updatePaginationChunks():r}updateMembersByMemberIds(e){if(null==this._members||!this._initialized)return!1;let t=e.reduce((e,t)=>{let r=i.default.getTrueMember(this.guildId,t);return null!=r&&e.push(r),e},[]);return this.updateClientMembers(t)}updateMembersSort(e){return new Promise(t=>{let r=(0,n.cloneDeep)(this.getMembersByIndex(l.MemberSafetySecondaryIndex.CURRENT_GUILD_MEMBER)[0]);[...r,...(0,n.cloneDeep)(this.getMembersByIndex(l.MemberSafetySecondaryIndex.NEW_GUILD_MEMBER)[0])].forEach(t=>{let r=(0,c.getSortValueForMember)(t,e),n=this._search?.isMemberIncludedInSearchResults(t)??!1;this._members?.updateMember(t,{sort:r,isIncludedInSearchResults:n})}),t()})}sortMembersBySelectedSort(e){null!=this._search&&null!=this._members&&this._initialized&&null!=e&&(this.updatePaginationState({sort:e},!0),this.updateMembersSort(e).then(()=>{this.updatePaginationChunks()}))}updateSearchedMembersByMemberIds(e){if(null==this._search||null==this._members||!this._initialized)return!1;let t=e.reduce((e,t)=>{let r=i.default.getTrueMember(this.guildId,t);return null!=r&&e.push(r),e},[]);return this.updateClientMembers(t,this._search.requiresUsernameMatch,0!==this.lastRefreshTimestamp)}rebuildAllMembers(){if(null==this._members||!this._initialized)return!1;let e=i.default.getMembers(this.guildId);return this.updateClientMembers(e)}_scheduleRefresh(e){this.lastRefreshTimestamp=e,this.lastCursorTimestamp=Date.now(),null!=this._lastRefreshTimer&&clearTimeout(this._lastRefreshTimer),this._lastRefreshTimer=setTimeout(()=>{this._lastRefreshTimer=null,this.lastRefreshTimestamp=0},_)}refreshNewMembersAndSearchResults(){if(null==this._search||null==this._members||!this._initialized)return!1;let e=Number(Date.now());this._scheduleRefresh(e);let t=(0,n.cloneDeep)(this._members.values(l.MemberSafetySecondaryIndex.NEW_GUILD_MEMBER)),r=!1;for(let n of t)r=this._members.updateMember(n,{isCurrentGuildMemberByTimestamp:!0,refreshTimestamp:e,user:a.default.getUser(n.userId)})||r;this._members.resetNewMemberTimestamp(),this.resetSearchState()&&(r=!1);let[i,u]=this.updatePaginationState({currentPage:1},!1);return u&&(r=!1),r&&this.updatePaginationChunks(),!0}getNewMemberTimestamp(){return null!=this._members&&this._initialized?this._members.newMemberTimestamp:0}updateSearchState(e){if(null==this._members||null==this._search||!this._initialized)return!1;let t=!!this._search.hasDefaultQuery;null!=e.selectedSort&&e.selectedSort!==this._search.getSearchState().selectedSort&&this.sortMembersBySelectedSort(e.selectedSort);let r=this._search.updateSearchState(e);if(this._search.hasDefaultQuery&&t)return this.updatePaginationChunks();let i=(0,n.cloneDeep)(this._members.values(l.MemberSafetySecondaryIndex.CURRENT_GUILD_MEMBER)),a=t!==this._search.hasDefaultQuery;for(let e of i){if(!e.isCurrentGuildMemberByTimestamp)continue;let t=this._search.isMemberIncludedInSearchResults(e);t!==e.isIncludedInSearchResults&&(a=!0,r=!0,this._members.updateMember(e,{isIncludedInSearchResults:t}))}return a?(this.updatePaginationChunks(),this.updatePaginationState({currentPage:1}),!0):r}getSearchState(){return null!=this._search&&this._initialized?this._search.getSearchState():(0,d.getDefaultSearchState)()}hasDefaultSearchState(){return null==this._search||!this._initialized||this._search.hasDefaultQuery}resetSearchState(){return!!(null!=this._search&&this._initialized&&this._search.resetSearchState())&&this.updatePaginationChunks()}getTotalResultsCount(){return null!=this._search&&null!=this._pagination&&this._initialized?this._search.hasDefaultQuery&&null!=this._defaultSearchTotalResultsCount?this._defaultSearchTotalResultsCount:this._pagination.getPaginationState().totalResultsCount:0}updatePaginationState(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1];return null!=this._search&&null!=this._pagination&&this._initialized?(t&&(this.lastRefreshTimestamp=0),this._search.hasDefaultQuery&&null!=e.totalResultsCount&&(this._defaultSearchTotalResultsCount=e.totalResultsCount),this._pagination.updatePaginationState(e)):[!1,!1]}clearPaginationState(){this._pagination?.reset()}getPaginationState(){return null!=this._pagination&&this._initialized?this._pagination.getPaginationState():(0,o.createDefaultMemberSafetyPaginationState)()}getPaginatedMembers(){return null!=this._pagination&&this._initialized?[this._pagination.paginatedMembers,this._pagination.version]:[{},0]}updatePaginationToken(e){return null!=this._pagination&&!!this._initialized&&this._pagination.updatePaginationToken(e)}getElasticSearchPagination(){return null!=this._pagination&&this._initialized?this._pagination.getElasticSearchPagination():null}removeRoleFromSearchState(e){let t=new Set(this.getSearchState().selectedRoleIds);return t.delete(e),this.updateSearchState({selectedRoleIds:t})}}"
    }
}